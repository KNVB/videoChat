<html>
	<head>
		<meta charset="utf-8">
		<title>Display Webcam Stream</title>
		<style>
			#container {
				align-items:center;
				display:flex;
				flex-direction: column;
				justify-content:center;
				width:100%;
				position:relative;
			}
			#control{
				align-items:center;
				border-bottom:10px solid black;
				border-left:10px solid black;
				border-right:10px solid black;
				display:flex;
				flex-direction: row;
				justify-content:center;
				width:95%;
			}
			#video{
				width:95%;
				padding:0px;
				margin:0px;
				background-color:#666;
				height:600px;
				border:10px solid black;
			}
		</style>
		<script>
			var mediaStream=null;
			var constraints = {};
			function getAudioConfig() {
				var result=	{
								channelCount: 2,
								echoCancellation:false,
								sampleSize: 16
							};
				return result;			
			}
			function getVideoConfig(cameraSrc,video) {
				var result={width:1920,height:1080};
				switch (cameraSrc){
						case 'user':  //Front Camera
									result.facingMode="user";
									video.style.transform="scaleX(-1)"; //If front Camera is selected , mirror the image.
									break;
						case "environment": //Rear Camera
											result.facingMode={exact: 'environment'};
											video.style.transform=""; //If rear Camera is selected , remove mirror from the image.
											break
						default: throw "Please select camera first";
								break;
						
					}
				return result;
			}
			function hasGetUserMedia() {
			  return !!(navigator.mediaDevices &&
				navigator.mediaDevices.getUserMedia);
			}			
			function start(v) {
				var isConfigOk=false;
				var cameraSrc=v.camera.value;
				var mediaSrc=v.mediaSrc.value;
				var video=document.getElementById("video");
				
				constraints = {}; //init the constraints
				switch (mediaSrc) {
					case "audio":
								constraints.audio=getAudioConfig();
								play(constraints,video);
								break;
					case "video":
								try {
									constraints.video=getVideoConfig(cameraSrc,video);
									play(constraints,video);
								} catch(e) {
									alert(e);
								}
								break;
					case "both":
								constraints.audio=getAudioConfig();
								try {
									constraints.video=getVideoConfig(cameraSrc,video);
									play(constraints,video);
								} catch(e) {
									alert(e);
								}
								break;
					default:
							alert("Please select media source first");
							break;
				}
			}
			function play(constraints,video) {
				if (hasGetUserMedia()) {
					console.log(constraints);
					navigator.mediaDevices.getUserMedia(constraints)
					.then((stream) => 
						{
							mediaStream=stream;
							video.srcObject = stream;
							video.play();
						})
					.catch((error)=> 
						{
							alert("Getting Media failure:"+error);
							console.log(constraints);
						});
					} else {
						alert('getUserMedia() is not supported by your browser');
					}
			}
			function stopMedia() {
				if (mediaStream!=null) {
					mediaStream.getTracks().forEach((track)=> {
						track.stop();
					});
					mediaStream=null;
				}
			}
		</script>
	</head>
	<body>
		<form>
			<div id="container">
				<video id="video"></video>
				<div id=control>
					<fieldset>
						<legend>Media Source:</legend>
						<input type="radio" name="mediaSrc" value="video">Video<br>
						<input type="radio" name="mediaSrc" value="audio">Audio<br>
						<input type="radio" name="mediaSrc" value="both">Both<br>
					</fieldset>
					<fieldset>
						<legend>Camera:</legend>
						<input type="radio" name="camera" value="user">Front<br>
						<input type="radio" name="camera" value="environment">Rear<br>
					</fieldset>
					<fieldset>
						<legend>Action:</legend>
						<input type=button onclick="start(this.form)" value="Start"><br>
						<input type=button onclick="stopMedia()" value="Stop">
					</fieldset>
				</div>
			</div>
		</form>
	</body>
</html>
<html>
	<head>
		<script src="WebRTC.js"></script>
		<script>
			var webRTC=new WebRTC();
			function go() {
				var pc=webRTC.getPeerConnection();
				pc.onicecandidate=handleicecandidate;
				pc.onconnectionstatechange = handleconnectionstatechange;
				pc.oniceconnectionstatechange = handleiceconnectionstatechange;
								
				navigator.mediaDevices.getUserMedia({"audio": true, "video": true}).then((stream) => {
					//console.log("selfView.srcObject="+selfView.srcObject);
					//selfView.srcObject=stream;
					stream.getTracks().forEach((track)=> {
							webRTC.addTrack(track,stream);
					});
					webRTC.createOffer().then(createOfferDone, createOfferFailed);
				});
				var dataChannel =webRTC.createDataChannel("chat");
				dataChannel.onopen = datachannelopen;
				dataChannel.onmessage = datachannelmessage;
			}
			function createOfferDone(offer) {
			  console.log('createOfferDone');
			  webRTC.setLocalDescription(offer).then(setLocalDone, setLocalFailed);
			}

			function createOfferFailed(reason) {
			  console.log('createOfferFailed');
			  console.log(reason);
			}
			function datachannelopen() {
			  console.log('datachannelopen');
			  console.log('connected');
			}

			function datachannelmessage(message) {
			  console.log('datachannelmessage');
			  console.log(message);
			  text = message.data;
			  console.log(text);
			}
			
			function handleconnectionstatechange(event) {
			  console.log('handleconnectionstatechange');
			  console.log(event);
			}

			function handleiceconnectionstatechange(event) {
			  console.log('ice connection state: ' + event.target.iceConnectionState);
			}
			function handleicecandidate() {
				return function(event) {
				if (event.candidate != null) {
				  console.log('new ice candidate');
				} else {
				  console.log('all ice candidates');
				 // lasticecandidate();
				}
			  }
			}
			function setLocalDone() {
			  console.log('setLocalDone');
			}

			function setLocalFailed(reason) {
			  console.log('setLocalFailed');
			  console.log(reason);
			}
		</script>
	</head>
	<body>
		<button onclick="go()">Go</button>
	</body>
</html>